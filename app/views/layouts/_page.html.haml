- @main_wrapper_class =  "gl-@container/main" if @allow_main_container_query

.layout-page{ class: page_with_sidebar_class }
  -# Render the parent group sidebar while creating a new subgroup/project, see GroupsController#new.
  - group = @parent_group || @group
  - context = group || @project
  - alert_class = "container-limited" unless fluid_layout

  - sidebar_panel = super_sidebar_nav_panel(nav: nav, user: current_user, group: group, project: @project, current_ref: current_ref, ref_type: @ref_type, viewed_user: @user, organization: @organization)
  - sidebar_data = super_sidebar_context(current_user, group: group, project: @project, panel: sidebar_panel, panel_type: nav).to_json
  %aside.js-super-sidebar.super-sidebar.super-sidebar-loading{ data: { root_path: root_path, sidebar: sidebar_data, force_desktop_expanded_sidebar: @force_desktop_expanded_sidebar.to_s, command_palette: command_palette_data(project: @project, current_ref: current_ref).to_json, is_saas: Gitlab.com?.to_s } }

  = render_if_exists "layouts/tanuki_bot_chat" if context
  = render_if_exists "layouts/session_expire_modal"

  - if Feature.enabled?(:paneled_view, current_user)
    .panels-container.gl-flex{ class: 'gl-h-[100vh] gl-gap-3' }
      .content-wrapper.paneled-view.gl-flex-1.gl-overflow-y-auto.gl-bg-default{ class: "#{@content_wrapper_class}" }
        -# Broadcast messages
        .broadcast-wrapper
          = dispensable_render_if_exists "shared/token_expiration_banner"
          = dispensable_render "layouts/broadcast" unless content_for(:hide_broadcast_messages).present?

        = render 'layouts/alerts', alert_class: alert_class, context: context

        -# Top bar
        - unless @hide_top_bar
          = render "layouts/nav/top_bar", paneled_view: true

        %div{ class: "#{container_class unless @no_container} #{@content_class}" }
          %main.content{ id: "content-body", class: "gl-@container/main", **page_itemtype }
            = render "layouts/flash" unless @hide_flash
            = yield :after_flash_content
            = yield :before_content
            = yield
        = yield :after_content
        -# This is needed by [GitLab JH](https://gitlab.com/gitlab-jh/jh-team/gitlab-cn/-/issues/81)
        = render_if_exists "shared/footer/global_footer"


      #contextual-panel-portal.paneled-view.gl-flex-1.gl-overflow-y-auto.gl-rounded-lg.gl-bg-default.empty:gl-hidden{ class: 'gl-@container' }

      .paneled-view
        #duo-chat-panel

  - else
    .content-wrapper{ class: "#{@content_wrapper_class}" }
      -# Broadcast messages
      .broadcast-wrapper
        = dispensable_render_if_exists "shared/token_expiration_banner"
        = dispensable_render "layouts/broadcast" unless content_for(:hide_broadcast_messages).present?

      = render 'layouts/alerts', alert_class: alert_class, context: context

      -# Top bar
      - unless @hide_top_bar
        = render "layouts/nav/top_bar", paneled_view: false

      %div{ class: "#{container_class unless @no_container} #{@content_class}" }
        %main.content{ id: "content-body", **page_itemtype, class: @main_wrapper_class }
          = render "layouts/flash" unless @hide_flash
          = yield :after_flash_content
          = yield :before_content
          = yield
      = yield :after_content
      -# This is needed by [GitLab JH](https://gitlab.com/gitlab-jh/jh-team/gitlab-cn/-/issues/81)
      = render_if_exists "shared/footer/global_footer"
