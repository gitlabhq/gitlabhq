= render Pajamas::CardComponent.new(card_options: { class: 'gl-mb-8' }) do |c|
  - c.with_header do
    %h2.gl-text-size-h2.gl-font-bold.gl-text-center.gl-m-0
      = s_('Observability|Your OpenTelemetry endpoint configuration')
  - c.with_body do
    .gl-p-6
      %p.gl-mb-6
        - if configuration_settings.provisioning?
          = s_('Observability|Your OpenTelemetry (OTel) telemetry data collection endpoints are being provisioned. Once complete, they will be ready to receive data. Please configure your instrumentation with the following endpoints:')
        - else
          = s_('Observability|Your OpenTelemetry (OTel) telemetry data collection endpoints have been provisioned and are ready to receive data. Please configure your instrumentation with the following endpoints:')

      %h3.gl-heading-3
        = s_('Observability|Endpoint details')

      .gl-flex.gl-flex-col.gl-gap-4.gl-mb-6
        .gl-flex.gl-gap-2.gl-items-center
          %span.gl-font-bold= s_('Observability|HTTP Endpoint')
          .gl-flex.gl-gap-2.gl-items-center
            %code.gl-p-2.gl-rounded-base
              = configuration_settings.otel_http_endpoint
            = clipboard_button(text: configuration_settings.otel_http_endpoint, title: s_('Observability|Copy HTTP endpoint'))

        .gl-flex.gl-gap-2.gl-items-center
          %span.gl-font-bold= s_('Observability|gRPC Endpoint')
          .gl-flex.gl-gap-2.gl-items-center
            %code.gl-p-2.gl-rounded-base
              = configuration_settings.otel_grpc_endpoint
            = clipboard_button(text: configuration_settings.otel_grpc_endpoint, title: s_('Observability|Copy gRPC endpoint'))

      %h3.gl-heading-3
        = s_('Observability|Configuration notes')

      %ul.gl-mb-6
        %li.gl-mb-2
          = s_('Observability|The HTTP endpoint (port 4318) accepts OTLP/HTTP protocol and is suitable for applications using HTTP-based transport')
        %li.gl-mb-2
          = s_('Observability|The gRPC endpoint (port 4317) accepts OTLP/gRPC protocol and is recommended for applications requiring persistent connections or streaming capabilities')
        %li.gl-mb-2
          = s_('Observability|Both endpoints support the full range of OpenTelemetry signal types: traces, metrics, and logs')
        %li.gl-mb-2
          = s_('Observability|Network requirements: Allow outbound TCP connections to the endpoints listed above')
        %li.gl-mb-2
          = safe_format(s_('Observability|Firewall configuration: Open outbound access to %{endpoint} on ports 4317-4318'), endpoint: configuration_settings.otel_address)
        %li.gl-mb-2
          = s_('Observability|VPN and proxy: If operating within a VPN or behind a proxy, ensure routing rules permit traffic to these external endpoints. Configure proxy settings in your OpenTelemetry SDK if required')

      %h3.gl-heading-3
        = s_('Observability|Next steps')

      %p.gl-mb-4
        - otel_docs_link = link_to('', 'https://opentelemetry.io/docs/languages/', target: '_blank', rel: 'noopener noreferrer')
        = safe_format(s_('Observability|Configure your OpenTelemetry SDK or collector with the appropriate endpoint based on your chosen transport protocol. For detailed integration instructions specific to your language or framework, please refer to the %{otel_docs_link_start}OpenTelemetry documentation for your SDK%{otel_docs_link_end}.'), tag_pair(otel_docs_link, :otel_docs_link_start, :otel_docs_link_end))

      %h4.gl-heading-4
        = s_('Observability|CI/CD Observability settings')

      - gitlab_observability_export_variable = configuration_settings.group.variables.by_key('GITLAB_OBSERVABILITY_EXPORT').first
      - if gitlab_observability_export_variable.present?
        = render Pajamas::AlertComponent.new(variant: :success, dismissible: false, alert_options: { class: 'gl-mb-4' }) do |c|
          - c.with_body do
            = s_('Observability|Observability for CI/CD is enabled! Your CI/CD pipelines are automatically configured to export telemetry data, giving you comprehensive insights into your build and deployment processes.')
      - else
        = render Pajamas::AlertComponent.new(variant: :info, dismissible: false, alert_options: { class: 'gl-mb-4' }) do |c|
          - c.with_body do
            - ci_cd_settings_link = link_to('', group_settings_ci_cd_path(configuration_settings.group, anchor: 'ci-variables'), target: '_blank', rel: 'noopener noreferrer')
            = safe_format(s_('Observability|To enable Observability for CI/CD, set the %{variable_name} CI/CD variable in your group\'s %{settings_link_start}CI/CD settings%{settings_link_end} to a comma-separated list of data types to export: metrics, logs, and/or traces (e.g., %{metrics_logs} or %{all_data_types}).'), tag_pair(ci_cd_settings_link, :settings_link_start, :settings_link_end), variable_name: '<code>GITLAB_OBSERVABILITY_EXPORT</code>'.html_safe, metrics_logs: '<code>metrics,logs</code>'.html_safe, all_data_types: '<code>metrics,logs,traces</code>'.html_safe)

      %p
        = s_('Observability|If you encounter any connectivity issues or require additional configuration assistance, please contact your system administrator with the endpoint details provided above.')

      %h3.gl-heading-3
        = s_('Observability|Testing your endpoints')

      %p.gl-mb-4
        - if configuration_settings.provisioning?
          = s_('Observability|Once provisioned, you can test your HTTP endpoint by sending a sample OpenTelemetry payload using curl. This helps verify that your endpoint is accessible and configured correctly.')
        - else
          = s_('Observability|You can test your HTTP endpoint by sending a sample OpenTelemetry payload using curl. This helps verify that your endpoint is accessible and configured correctly.')

      - example_trace_id = "0000000000000000a1b2c3d4e5f67890"
      - example_span_id = "a1b2c3d4e5f67890"
      - example_time_nano = (Time.now.to_f * 1_000_000_000).to_i.to_s
      :ruby
        json_payload = {
          resourceSpans: [{
            resource: {
              attributes: [{
                key: "service.name",
                value: { stringValue: "test-service" }
              }]
            },
            scopeSpans: [{
              spans: [{
                traceId: example_trace_id,
                spanId: example_span_id,
                name: "test-span",
                kind: 1,
                startTimeUnixNano: example_time_nano,
                endTimeUnixNano: example_time_nano,
                attributes: []
              }]
            }]
          }]
        }.to_json
        curl_command_lines = [
          "curl -X POST #{configuration_settings.otel_http_endpoint}/v1/traces \\",
          "  -H 'Content-Type: application/json' \\",
          "  -d '#{json_payload}'"
        ]
        curl_command_single_line = "curl -X POST #{configuration_settings.otel_http_endpoint}/v1/traces -H 'Content-Type: application/json' -d '#{json_payload}'"

      .gl-flex.gl-flex-col.gl-gap-2.gl-mb-6
        %span.gl-font-bold= s_('Observability|Example curl command')
        .gl-flex.gl-gap-2.gl-items-start
          %pre.gl-p-3.gl-rounded-base.gl-bg-gray-50.gl-overflow-x-auto
            %code
              = curl_command_lines.join("\n")
          = clipboard_button(text: curl_command_single_line, title: s_('Observability|Copy curl command'))
= render Pajamas::CardComponent.new(card_options: { class: 'gl-mb-8' }) do |c|
  - c.with_header do
    %h2.gl-text-size-h2.gl-font-bold.gl-text-center.gl-m-0
      = s_('Observability|We value your feedback')
  - c.with_body do
    .gl-p-6
      %p.gl-mb-4
        = s_('Observability|As this is an experimental feature, your insights are important to us. Please don\'t hesitate to reach out with:')

      %ul.gl-mb-6
        %li.gl-mb-2= s_('Observability|Feature requests')
        %li.gl-mb-2= s_('Observability|Bug reports')
        %li.gl-mb-2= s_('Observability|General feedback and suggestions')

      %p
        - issue_link_url = 'https://gitlab.com/gitlab-org/embody-team/experimental-observability/gitlab_o11y/-/issues/37'
        - issue_link = link_to('', issue_link_url, target: '_blank', rel: 'noopener noreferrer')
        - discord_link_url = 'https://discord.gg/xGJeDSWzq4'
        - discord_link = link_to('', discord_link_url, target: '_blank', rel: 'noopener noreferrer')
        = safe_format(s_('Observability|You can contact us through our %{issue_link_start}feedback issue in GitLab%{issue_link_end}. You can also join our %{discord_link_start}Discord channel%{discord_link_end} for community discussions and support.'), tag_pair(issue_link, :issue_link_start, :issue_link_end), tag_pair(discord_link, :discord_link_start, :discord_link_end))
