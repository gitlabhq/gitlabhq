#!/bin/sh

cd $(dirname $0)/.. || exit 1
app_root=$(pwd)

mail_room_pidfile="$app_root/tmp/pids/mail_room.pid"
mail_room_logfile="$app_root/log/mail_room.log"
mail_room_config="$app_root/config/mail_room.yml"

get_mail_room_pid()
{
  local pid
  pid=$(cat $mail_room_pidfile)
  if [ -z "$pid" ] ; then
    echo "Could not find a PID in $mail_room_pidfile"
    exit 1
  fi
  mail_room_pid=$pid
}

start()
{
  bin/daemon_with_pidfile $mail_room_pidfile bundle exec mail_room --log-exit-as json -q -c $mail_room_config >> $mail_room_logfile 2>&1
}

stop()
{
  get_mail_room_pid
  kill -TERM $mail_room_pid
}

restart()
{
  stop
  start
}

case "$1" in
  start)
    start
    ;;
  stop)
    stop
    ;;
  restart)
    restart
    ;;
  *)
    echo "Usage: $0 {start|stop|restart}"
    ;;
esac
